<template>
  <!-- 学校选择页面 -->
	<view class="xcdd-select-gzjh child-content">
		<!-- 蒙版 -->
		<view class="xcdd-select-gzjh-mask" @tap="close"></view>
		<!-- 搜索 -->
		<view class="xcdd-select-gzjh-content">
			<kw-search placeholder="请输入学校名称" @confirm="keywordConfirm"></kw-search>
			<radio-group @change="radioChange">
				<label class="" v-for="(item,j) in loadDataList" :key="j" :class="{xcddSelectGzjBorderBottom: j < loadDataList.length-1}">
					<radio :value="item.value" name="school" />
					<view class="xcdd-select-gzjh-radio-label">{{item.name}}</view>
				</label>
			</radio-group>
			<view class="xcdd-select-gzjh-save" @tap="loadSchool()">
        <button :disabled="!moreName">{{moreName ? "点击加载更多":"已无更多数据"}}</button>
      </view>
		</view>
	</view>
</template>

<script>
	import KwSearch from "@kwz/kw-ui/kw-search.vue"
	export default {
		components: {KwSearch},
		data() {
			return {
				// 搜索学校用的关键字
				ORG_MC: "",
				page: 1,
				// 学校列表
				loadDataList: [],
				// 加载提示文字
				moreName: true,
        // 用来存储prop的默认选中值
        defaultRadio: []
			}
		},
		props: {
			// 默认选中的值 多选所以要传数组
			checkRadio: {
				type: [Object,Array,String],
				default () {
					return []
				}
			}
		},
// 		onLoad() {
//       this.defaultRadio = this.checkRadio
// 			this.loadSchool(true)
// 		},
    // 疑似uniapp自定义组件不支持页面生面周期，故用vue生命周期
    created() {
      this.defaultRadio = this.checkRadio
			this.loadSchool(true)
    },
		methods: {
			// 加载学校 type => true(全新)/false(增量)
			loadSchool(type) {
				this.page = type ? 1 : this.page
				this.$kwz.ajax.ajaxUrl({
					url: 'dd_gzap/getSchoolPage',
					type: 'POST',
					data: {
						DDJL: '',
            page: this.page,
            ORG_MC: this.ORG_MC
					},
					vue: this,
					success(data) {
						let datas = data.datas
						this.page++
            if (datas && datas.length > 0) {
              let loadDataList = []
              let xxList = datas
              for (let i = 0; i < xxList.length; i++) {
                loadDataList.push({
                  value: xxList[i].ORG_ID,
                  name: xxList[i].ORG_MC,
                  data: xxList[i]
                })
              }
              if (type) {
                this.loadDataList = loadDataList
              } else {
                this.loadDataList = this.loadDataList.concat(loadDataList)
              }
              this.moreName = true
            }else{
              this.moreName = false
              this.loadDataList = type ? [] : this.loadDataList
            }
					}
				})
			},
			// 从list中取出对象
			getRadioValue(id) {
				if (this.loadDataList.length > 0) {
					for (let i = 0; i < this.loadDataList.length; i++) {
						if (id == this.loadDataList[i].value) {
							return this.loadDataList[i]
						}
					}
				}
				return {}
			},
			// 选择时进行改变
			radioChange(e) {
				// this.checkRadio = e.detail.value;
        this.defaultRadio = e.detail.value;

				this.$emit("confirm", {
					// data: this.getRadioValue(this.checkRadio)
          data: this.getRadioValue(this.defaultRadio)

				})
			},
			// 点击蒙版(取消用的)
			close() {
				this.$emit("close")
			},
			// 关键字输入
			keywordConfirm(e) {
				this.ORG_MC = e.value
				this.loadSchool(true)
			}
		}
	}
</script>

<style lang="scss">
  
  .xcdd-select-gzjh{
    position: fixed;
    top:44px;
    left: 0;
    width: 750upx;
    padding: 80upx 20upx;
    z-index: 1001;
    background: rgba(0, 0, 0, 0.2);
    height: calc(100vh - 44px);
    /* #ifdef MP-WEIXIN */
    height: 100vh;
    top: 0;
    /* #endif */
    label{
      display: inline-block;
      background: white;
      width: 100%;
      padding: 20upx !important;
      position: relative;
      box-sizing: border-box;
    }
    radio-group{
      max-height: calc(100% - 235upx);
      overflow: auto;
    }
    .kw-search,.kw-search-body{
      border-radius:10upx 10upx 0 0;
    }
  }
  .xcdd-select-gzjh-mask{
    z-index: auto;
    position: fixed;
    // background: rgba(0, 0, 0, 0.5);
    height: calc(100vh - 44px);
    width: 100%;
    top: 44px;
    left: 0;
    /* #ifdef MP-WEIXIN */
    height: 100vh;
    top: 0;
    /* #endif */
  }
  .xcdd-select-gzjh-content{
    z-index: 1001;
    margin: auto;
    width: 100%;
    background: white;
    height: 100%;
    box-shadow: 0 0 15upx 5upx darkgray;
    padding-bottom: 20upx;
    border-radius: 10upx;
  }
  .xcdd-select-gzjh-radio-label{
    text-align: right;
    position: absolute;
    right: 20upx;
    top:20upx;
  }
  .xcddSelectGzjBorderBottom::after{
    position: absolute;
    z-index: 3;
    right: 0;
    bottom: 0;
    left: 0;
    height: 1px;
    content: '';
    transform: scaleY(.5);
    background-color: #c8c7cc;  
    margin:0 20upx;
  }
  .xcdd-select-gzjh-save{
    width: 670upx;
    height: 85upx;
    border-radius: 42.5upx;
    border: solid 1upx #e1e1e1;
    margin: 0 20upx;
    display: flex;
    background: white;
    button{
      padding: 0;
      margin: 0;
      width: 100%;
      border-radius: 42.5upx;
      background: linear-gradient(90deg, #00befe 0%, #028edf 100%), linear-gradient(#109dea, #109dea);
      color: white;
      line-height: 83upx;
    }
    button:after{
      border: none;
    }
  }
</style>
