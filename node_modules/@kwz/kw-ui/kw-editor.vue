<template>
	<view class="kw-editor">
    <!-- 输入框 -->
		<view class="kw-editor-content">
			<textarea class="kw-editor-content-textarea" :value="contentA" @input="changeEditor" maxlength="4000"></textarea>
		</view>
    <!-- 图片组 -->
		<view class="kw-editor-images">
			<!-- 以下是图片 -->
			<view class="kw-editor-img" v-for="(item,key) in content.images" :key="key">
			  <view class="kw-editor-img-content">
					<image :src="item.content"></image>
			    <!-- 删除按钮 -->
			    <view class="kw-editor-del" @click="removeImage(key)">
			      <uni-icon type="closeempty" size="40" color="red"></uni-icon>
			    </view>
			  </view>
			</view>
      <!-- 添加按钮 -->
      <view class="kw-editor-img" @click="addImage">
        <view class="kw-editor-img-content">
          <view class="kw-editor-add">
            <uni-icon type="plusempty" color="#c8c7cc"></uni-icon>
            <view class="kw-editor-add-info">点击添加图片</view>
          </view>
        </view>
      </view>
		</view>	
  </view>
</template>

<script>
  export default {
		name: 'editor',
		components:{},
		data () {
			return {
				contentA: ''
			}
		},
    props:{
      content: {
				type: Object,
				default () {
					return {
						content: '',
						images: []
					}
				}
			}
    },
    onReady() {
      this.contentA = this.content.content
    },
   	methods:{
      // 添加图片
			addImage () {
				this.$kwz.uploadImage({
				},{
					url: 'ueditor/jsp/controller.jsp?action=uploadimage',
					success (image, tempImage) {
            console.log(this.content)
						if (image && image.url) {
							if(!this.content.images) {
								this.content.images = []
							}
							this.content.images.push({
								type: 'image',
								content: this.$kwz.ajax.url(image.url),
								imageUrl : image.url
							})
						}
						this.contentA = this.content.content
					}
				}, this)
			},
      // 删除图片
			removeImage (index) {
				this.$kwz.confirm('是否移除图片？',() => {
					let newImages = []
					let images = this.content.images
					for(let i = 0;i <images.length;i++) {
						if(index != i) {
							newImages.push(images[i])
						}
					}
					this.content.images = newImages
				})
			},
			addVideo () {
			},
      // 更改文本与文字
			changeEditor (e) {
				this.content.content = e.detail.value
			}
		}
  }
</script>

<style lang="scss">
  .kw-editor{
    position: relative;
    width: 100%;
    min-height: 600upx;
    border:#dddddd solid 1upx;
    display: flex;
    flex-direction: column;
  }
	.kw-editor-content{
		.kw-editor-content-textarea{
			padding: 8upx;
			border-bottom:#dddddd solid 1upx;
			height: 400upx;
			width: 100%
		}
	}
  .kw-editor-images{
    display: flex;
    flex-wrap:wrap;
    height: 200upx;
    padding: 8upx;
    width: 100%;
    overflow: scroll;
    .kw-editor-img{
      display: inline-block;
      max-width: 33.3%;
      padding: 6upx 37upx;
      width: 33%;
      height: 172upx;
      // width: 200upx;
      
      // display: flex;
      // flex-direction:row;
      // justify-content:center;
      .kw-editor-img-content{
        background:#f3f2f3;
        border: 1upx solid #c8c7cc;
        height: 100%;
        width:100%;
        position: relative;       
      }
      .kw-editor-del{
        position: absolute;
        top:-15upx;
        right: -15upx;
      }
      .kw-editor-add{
        position: relative;
        .kw-editor-add-info{
          position: absolute;
          bottom: 5upx;
          text-align: center;
          font-size:20upx;
          color: #999999;
          width: 100%;
        }
        .uni-icon{
          font-size: 155upx;
        }
      }
      image{
        width:100%;
        height: 100%;
      }
    }
  }
</style>
