<template>
	<view class="kw-editor">
    <view class="kw-editor-head">
      <view class="kw-editor-gn" @click="addImage">添加图片</view>
      <!-- <view class="kw-editor-gn" @click="addVideo">添加视频</view> -->
    </view>
    <view class="kw-editor-body">
			<view v-for="(item, key) in content" :key="key" >
				<textarea v-if="item.type == 'textarea'" v-model="item.content" maxlength="4000" :auto-height="true"></textarea>
				<view class="kw-editor-img" v-if="item.type == 'image' " >
				  <view class="kw-editor-imgDel">
						<icon type="cancel" size="26" @click="removeImage(key)"/></view>
						<image :src="item.content"/>
				</view>
			</view>
			
      <!-- <view class="kw-editor-img">
        <view class="kw-editor-imgDel"><icon type="cancel" size="26"/></view>
        <image src="../../../static/images/DefaultImg.png"/>
      </view> -->
      <!-- <textarea maxlength="4000" auto-height="true"></textarea> -->
    </view>
  </view>
</template>

<script>
  export default {
		name: 'editor',
		components:{},
		data () {
			return {
				// content: []
			}
		},
    props:{
      content: {
				type: Array,
				default () {
					return {
						type: 'textarea',
						content: ''
					}
				}
			}
    },
		methods:{
			addImage () {
				this.$kwz.uploadImage({
				},{
					url: 'ueditor/jsp/controller.jsp?action=uploadimage',
					success (image, tempImage) {
						if (image && image.url) {
							this.content.push({
								type: 'image',
								content: this.$kwz.ajax.url(image.url),
								imageUrl : image.url
							})
							this.content.push({
								type: 'textarea',
								content: ''
							})
						}
					}
				}, this)
			},
			removeImage (index) {
				let contentLength = this.content.length;
				let content = []
				for (let i = 0 ;i < contentLength; i++) {
					if (i < (index - 1) || i > index + 1) {
						content.push(this.content[i])
					} else {
						if (this.content[index -1].type == 'textarea' && this.content[index + 1].type == 'textarea') {
							this.content[index -1].content += this.content[index + 1].content
							content.push(this.content[index -1])
						} else {
							content.push(this.content[index -1])
							content.push(this.content[index +1])
						}
						i += 2
					}
				}
				this.content = content
			},
			addVideo () {
			}
		}
  }
</script>

<style lang="scss">
  .kw-editor{
    position: relative;
    width: 100%;
    height: 600upx;
    border:#dddddd solid 2upx;
    display: flex;
    flex-direction: column;
  }
  .kw-editor-head{
    width: 100%;
    height: 100upx;
    position: absolute;
    top:0;
    left:0;
    border-bottom: #dddddd solid 2upx;
    display: flex;
    flex-direction: row;
    .kw-editor-gn{
      padding:0 20upx;
      line-height: 98upx;
    }
  }
  .kw-editor-body{
    width: 100%;
    height: 496upx;
    position: absolute;
    top:100upx;
    left:0;
    padding: 20upx;
    overflow: auto;
    .kw-editor-img{
      width:100%;
      position: relative;
      image{
        width:100%;
      }
      .kw-editor-imgDel{
        position: absolute;
        top: 5upx;
        right: 5upx;
        width: 50upx;
        height: 50upx;
      }
    }
  }
</style>
